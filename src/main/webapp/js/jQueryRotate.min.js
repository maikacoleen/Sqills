$.fn.rotate=function(t){var e,n,a=$(this),r=0;function s(t){var n=!1,a=document.createElement("div").style;return $.each(e,function(e,r){""===a[r.replace(/\-/g,"")+t]&&(n=!0)}),n}function o(t,n){var a={};return s.transform?($.each(e,function(e,r){a[r.toLowerCase()+t]=n||""}),a):a}return e=["-Webkit-","-Moz-","-O-","-ms-",""],n=$.extend({startDeg:!1,endDeg:360,duration:1,count:1,easing:"linear",animate:{},forceJS:!1},t),s.transform=s("Transform"),s.transition=s("Transition"),n.endDeg*=n.count,n.duration*=n.count,s.transition&&!n.forceJS?(/Firefox/.test(navigator.userAgent)&&(r=t&&t.animate||!(!1===n.startDeg||n.startDeg>=0)?25:0),a.queue(function(t){!1!==n.startDeg&&a.css(o("transform","rotate("+n.startDeg+"deg)")),setTimeout(function(){a.css(o("transition","all "+n.duration+"s "+n.easing)).css(o("transform","rotate("+n.endDeg+"deg)")).css(n.animate)},r),setTimeout(function(){a.css(o("transition")),n.persist||a.css(o("transform")),t()},1e3*n.duration-r)})):(!1===n.startDeg&&(n.startDeg=a.data("rotated")||0),n.animate.perc=100,a.animate(n.animate,{duration:1e3*n.duration,easing:$.easing[n.easing]?n.easing:"",step:function(t,e){var r;"perc"===e.prop&&(r=n.startDeg+(n.endDeg-n.startDeg)*t/100,a.css(o("transform","rotate("+r+"deg)")).css("filter",function(t){var e,n,a;return s.transform?"":(e=t>=0?Math.PI*t/180:Math.PI*(360+t)/180,"progid:DXImageTransform.Microsoft.Matrix(M11="+(n=Math.cos(e))+",M12="+-(a=Math.sin(e))+",M21="+a+",M22="+n+',SizingMethod="auto expand")')}(r)))},complete:function(){if(n.persist)for(;n.endDeg>=360;)n.endDeg-=360;else n.endDeg=0,a.css(o("transform"));a.css("perc",0).data("rotated",n.endDeg)}})),a};